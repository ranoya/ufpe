<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="pinterest" content="nopin" />
    <meta name="pinterest" content="nohover" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="keywords" content="" />
    <title>PluriLabs</title>
    <meta property="og:title" content="PluriLabs" />
    <meta name="generator" content="plataforma" />
    <meta name="description" content="descrição" />
    <meta property="og:description" content="descrição" />
    <meta name="author" content="Guilherme Ranoya" />
    <script src="https://datat.vercel.app/basicsmin.js"></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&&display=swap");

      html,
      body {
        margin: 20px;
        font-family: "Open Sans", sans-serif;
        font-optical-sizing: auto;
        font-style: normal;
      }

      h1 {
        font-family: "Montserrat", sans-serif;
        font-weight: 800;
        color: #c5e3e1;
      }

      .dropz {
        background-color: #eeeeee;
      }

      .onhover {
        background-color: #5ad6e1;
      }

      .nodrop {
        align-self: center;
        color: #759f9b;
        font-size: 12px;
        text-align: center;
      }

      .dragqueen {
        min-width: 50px;
        min-height: 50px;
        max-width: 300px;
        max-height: 300px;
        margin: 14px;
        background-color: #8383d1;
        padding: 10px;
        border-radius: 4px;
        color: white;
      }

      .dragging {
        background-color: #ff000044;
      }

      .estagio {
        background-color: #64647b;
      }

      .dropz {
        min-height: 30dvh;
      }

      #novo {
        position: fixed;
        bottom: 30px;
        right: 30px;
        border-radius: 20px;
        width: 40px;
        height: 40px;
        background-color: gray;
        color: white;
        font-family: Helvetica, Arial, sans-serif;
        font-size: 24px;

        z-index: 10;
        box-shadow: 0 2px 5px #00000044;
        text-align: center;
        line-height: 40px;
        cursor: pointer;
        transition: all 0.13s ease-out;
      }

      #novo:hover {
        right: 25px;
        width: 50px;
        bottom: 25px;
        height: 50px;
        border-radius: 25px;
        line-height: 50px;
        transition: all 0.13s ease-in;
        background-color: #07553d;
      }

      #trashdropzone {
        position: absolute;
        width: 100%;
        background-color: #00000000;
        height: 100%;
        z-index: 11;
      }

      #trash {
        position: fixed;
        bottom: 85px;
        right: 30px;
        border-radius: 20px;
        width: 40px;
        height: 40px;
        background-color: #b34545;
        color: white;
        font-family: Helvetica, Arial, sans-serif;
        font-size: 24px;

        z-index: 10;
        box-shadow: 0 2px 5px #00000044;
        text-align: center;
        line-height: 40px;
        cursor: pointer;
        transition: all 0.13s ease-out;
        display: none;
      }

      #trash:hover {
        right: 25px;
        width: 50px;
        bottom: 80px;
        height: 50px;
        border-radius: 25px;
        line-height: 50px;
        transition: all 0.13s ease-in;
        background-color: #e60c0c;
      }

      #botgrava {
        position: fixed;
        left: calc(50% + 145px);
        top: calc(50dvh + 45px);
        z-index: 102;
        background-color: #44dcae;
        box-shadow: 0 2px 5px #00000044;
        border-radius: 8px;
        overflow: hidden;
        width: 40px;
        height: 40px;
        border-radius: 20px;
        text-align: center;
        line-height: 40px;
        display: none;
        transition: all 0.13s ease-out;
        cursor: pointer;
      }

      #botgrava:hover {
        left: calc(50% + 140px);
        top: calc(50dvh + 40px);

        transition: all 0.13s ease-in;
        background-color: #00ffb2;
        border-radius: 8px;
        width: 50px;
        height: 50px;
        border-radius: 25px;
        line-height: 50px;
      }

      .cresce {
        right: 25px !important;
        width: 50px !important;
        bottom: 80px !important;
        height: 50px !important;
        border-radius: 25px !important;
        line-height: 50px !important;
        transition: all 0.13s ease-in;
        background-color: #e60c0c !important;
      }

      .mostra {
        display: block !important;
      }

      .pessoa {
        font-weight: 200;
        font-size: 14px;
      }

      .atv {
        font-weight: bold;
        font-size: 18px;
      }

      .inp {
        background-color: #d1ca83;
      }

      .cuida {
        background-color: #c998af;
      }

      .outro {
        background-color: #ada7aa;
      }

      #modalblur {
        position: fixed;
        width: 100%;
        height: 100dvh;
        top: 0;
        left: 0;
        background-color: #ffffff99;
        display: none;
        z-index: 90;
      }

      #modal {
        position: fixed;
        left: calc(50% - 200px);
        top: calc(50dvh - 230px);

        padding: 16px;
        width: 400px;
        height: 325px;
        z-index: 100;
        background-color: #567e72;
        box-shadow: 0 2px 5px #00000044;
        border-radius: 8px;
        overflow: hidden;
        color: white;
        display: none;
      }

      #cabecalho {
        background-color: #1a4035;
        margin-left: -16px;
        margin-top: -16px;
        width: calc(100% + 32px);
        height: 40px;
        padding-top: 20px;
        padding-left: 16px;
        color: white;
        font-weight: bolder;
        margin-bottom: 20px;
      }

      input,
      select {
        margin-top: 8px;
        margin-bottom: 16px;
        width: 70%;
        height: 36px;
        line-height: 36px;
        border-radius: 4px;
        border: 0 none transparent;
        padding-left: 10px;
        padding-right: 10px;
        font-size: 20px;
        color: #0a4336;
      }
    </style>
  </head>

  <body>
    <h1>PluriLabs / dDesign</h1>
    <br />

    <div
      id="matrizhorarios"
      style="
        display: grid;
        grid-template-columns: auto repeat(5, 1fr);
        gap: 10px 10px;
      "
    ></div>

    <div id="trash">
      <div id="trashdropzone"></div>
      <svg
        style="margin-top: 9px; height: 20px"
        viewBox="0 0 15 18"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M12.457 6.5L11.54 17.5H3.45996L2.54297 6.5H12.457Z"
          stroke="white"
        />
        <path
          d="M14 5V5.5H14.5V5H14ZM1 5H0.5V5.5H1V5ZM11.8457 3V3.5C12.1214 3.5 12.3589 3.50068 12.5752 3.52746C12.7886 3.55388 12.9457 3.60224 13.0636 3.67517C13.2553 3.7938 13.5 4.0797 13.5 5H14H14.5C14.5 3.9203 14.2061 3.2062 13.5898 2.82483C13.3037 2.64776 12.9895 2.57112 12.6981 2.53504C12.4095 2.49932 12.1084 2.5 11.8457 2.5V3ZM14 5V4.5H1V5V5.5H14V5ZM1 5H1.5C1.5 4.06603 1.73356 3.77855 1.90235 3.66603C2.12694 3.5163 2.45682 3.5 3 3.5V3V2.5C2.54318 2.5 1.87306 2.4837 1.34765 2.83397C0.766444 3.22145 0.5 3.93397 0.5 5H1ZM3 3V3.5H11.8457V3V2.5H3V3Z"
          fill="white"
        />
        <path d="M5 8.5L5.5 16M10 8.5L9.5 16" stroke="white" />
        <path d="M7.5 8.5V16" stroke="white" />
        <path d="M7.5 1L6 3H9L7.5 1Z" stroke="white" />
      </svg>
    </div>

    <div id="botgrava">✓</div>

    <div id="modal">
      <div id="cabecalho">Nova Atividade</div>
      <div class="modallabel">Atividade</div>
      <input id="ativ" type="text" />
      <div class="modallabel">Responsável</div>
      <input id="pessoa" type="text" />
      <div class="horario">Alocação</div>
      <select id="aloca">
        <option value="_segundaM" selected>Segunda - Manhã</option>
      </select>
    </div>
    <div id="modalblur" onclick="fechamodal()"></div>
    <div id="novo" onclick='ligamodal("Nova Atividade", ["",""])'>+</div>

    <script>
      modalvisible = false;

      const fechamodal = function () {
        document.getElementById("modal").style.display = "none";
        document.getElementById("modalblur").style.display = "none";
        document.getElementById("botgrava").style.display = "none";
        modalvisible = false;
      };

      const ligamodal = function (label, dados) {
        document.getElementById("cabecalho").innerHTML = label;
        document.getElementById("modal").style.display = "block";
        document.getElementById("modalblur").style.display = "block";
        document.getElementById("botgrava").style.display = "block";
        document.getElementById("ativ").value = dados[0] || "";
        document.getElementById("pessoa").value = dados[1] || "";
        modalvisible = true;
      };

      let labmatrix = [];

      const labquery = function (idf, arr) {
        let c = 0;
        for (let i = 0; i < arr.length; i++) {
          if (arr[i].id == idf) {
            break;
          }
          c++;
        }

        return c;
      };

      // serviço de gravação no Sheets (atualizar link conforme o Script é atualizado)
      let servico =
        "https://script.google.com/macros/s/AKfycbwDtYQqO4snJYU43ruxgMvFeLalcGruAS8zlR7MhR7B0n8GuzxsFyULrqUGziuRHF3v/exec" +
        "?planilha=1nTRipglhYAIXH8_CXS9lepaGPSv_b33AEm0-UNIIODA";

      const apresentainicial = function (dt) {
        labmatrix = dt;

        let code = `<div class="nodrop"></div>
                    <div class="nodrop">Segunda</div>
                    <div class="nodrop">Terça</div>
                    <div class="nodrop">Quarta</div>
                    <div class="nodrop">Quinta</div>
                    <div class="nodrop">Sexta</div>
                    <div class="nodrop">Manhã</div>`;

        let momentos = [
          "_segundaM",
          "_tercaM",
          "_quartaM",
          "_quintaM",
          "_sextaM",
        ];

        // Manhã
        for (let m = 0; m < momentos.length; m++) {
          code += `<div class="dropz" id="${momentos[m]}">`;

          let agendamentos = cfilter(dt, "matriz", momentos[m]);

          for (let a = 0; a < agendamentos.length; a++) {
            code += `<div id="${agendamentos[a].id}" class="dragqueen ${agendamentos[a].lab}" draggable="true"><span class="atv">${agendamentos[a].atividade}</span><br><span class="pessoa">${agendamentos[a].quem}</span></div>`;
          }

          code += `</div>`;
        }

        code += `<div class="nodrop">Tarde</div>`;

        momentos = ["_segundaT", "_tercaT", "_quartaT", "_quintaT", "_sextaT"];

        // Tarde
        for (let m = 0; m < momentos.length; m++) {
          code += `<div class="dropz" id="${momentos[m]}">`;

          let agendamentos = cfilter(dt, "matriz", momentos[m]);

          for (let a = 0; a < agendamentos.length; a++) {
            code += `<div id="${agendamentos[a].id}" class="dragqueen ${agendamentos[a].lab}" draggable="true"><span class="atv">${agendamentos[a].atividade}</span><br><span class="pessoa">${agendamentos[a].quem}</span></div>`;
          }

          code += `</div>`;
        }

        code += `</div>`;

        document.getElementById("matrizhorarios").innerHTML = code;

        // Draggable element
        const draggableItems = document.getElementsByClassName("dragqueen");

        // Drop zone
        const dropZone = document.getElementsByClassName("dropz");

        for (let i = 0; i < draggableItems.length; i++) {
          // Add dragstart event listener to the draggable item

          if (draggableItems[i].innerHTML.match(/estág|estag/i)) {
            draggableItems[i].classList.add("estagio");
          }

          draggableItems[i].addEventListener("dragstart", (e) => {
            console.log("começou o drag");
            e.dataTransfer.setData("text/plain", e.target.id); // Store the ID of the dragged element
            e.target.classList.add("dragging"); // Add a class for styling
            document.getElementById("trash").classList.add("mostra");
          });

          draggableItems[i].addEventListener("click", (e) => {
            console.log("clicou");
          });

          // Add dragend event listener to the draggable item
          draggableItems[i].addEventListener("dragend", (e) => {
            e.target.classList.remove("dragging"); // Remove dragging styling
            document.getElementById("trash").classList.remove("mostra");
          });
        }

        for (let i = 0; i < dropZone.length; i++) {
          // Add dragover event listener to the drop zone
          dropZone[i].addEventListener("dragover", (e) => {
            e.preventDefault(); // Prevent default to allow drop
            dropZone[i].classList.add("onhover");
          });

          dropZone[i].addEventListener("dragleave", (e) => {
            e.preventDefault(); // Prevent default to allow drop
            dropZone[i].classList.remove("onhover");
          });

          // Add drop event listener to the drop zone
          dropZone[i].addEventListener("drop", (e) => {
            e.preventDefault();
            const data = e.dataTransfer.getData("text/plain"); // Get the stored data
            const draggedElement = document.getElementById(data);
            dropZone[i].appendChild(draggedElement); // Move the element to the drop zone
            console.log("Elemento " + data + ", solto em " + dropZone[i].id);
            dropZone[i].classList.remove("onhover");
            labmatrix[labquery(data, labmatrix)].matriz = dropZone[i].id;

            // Grava

            let link = servico + "&id=" + data + "&p4=" + dropZone[i].id;

            fetch(link)
              .then((response) => {
                if (!response.ok) {
                  throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text();
              })
              .then((textData) => {
                console.log(textData);
                // The content of your .txt file
                // You can now manipulate 'textData' as needed
              });
          });
        }

        // Lixo
        const trashicon = document.getElementById("trash");
        const trashZone = document.getElementById("trashdropzone");
        trashZone.addEventListener("dragover", (e) => {
          e.preventDefault(); // Prevent default to allow drop
          trashicon.classList.add("cresce");
          console.log("tá no dragover do lixo");
        });

        trashZone.addEventListener("dragleave", (e) => {
          e.preventDefault(); // Prevent default to allow drop
          trashicon.classList.remove("cresce");
        });

        // Add drop event listener to the drop zone
        trashZone.addEventListener("drop", (e) => {
          e.preventDefault();
          const data = e.dataTransfer.getData("text/plain"); // Get the stored data
          const draggedElement = document.getElementById(data);
          draggedElement.style.display = "none";
          console.log("Elemento " + data + ", solto em " + trashZone.id);
          trashicon.classList.remove("cresce");
          labmatrix.splice(labquery(data, labmatrix), 1);

          // Grava

          let link = servico + "&id=" + data + "&remover=true";

          fetch(link)
            .then((response) => {
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              return response.text();
            })
            .then((textData) => {
              console.log(textData);
              // The content of your .txt file
              // You can now manipulate 'textData' as needed
            });
        });
      };

      // carrega dados

      gsdata(
        "https://docs.google.com/spreadsheets/d/1nTRipglhYAIXH8_CXS9lepaGPSv_b33AEm0-UNIIODA/edit?gid=0#gid=0",
        apresentainicial
      );
    </script>
  </body>
</html>
