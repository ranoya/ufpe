<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="pinterest" content="nopin" />
    <meta name="pinterest" content="nohover" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="keywords" content="" />
    <title>Bolsas PPGDesign</title>
    <meta property="og:title" content="PPGDesign" />
    <meta name="generator" content="static" />
    <meta name="description" content="Cronograma de bolsas do PPGDesign" />
    <meta
      property="og:description"
      content="Cronograma de bolsas do PPGDesign"
    />
    <meta name="author" content="Guilherme Ranoya" />
    <meta
      property="og:url"
      content="https://ufpe.vercel.app/ppgdesign/bolsas.html"
    />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="pt_BR" />
    <meta property="og:image:width" content="600" />
    <meta property="og:image:height" content="600" />
    <meta property="og:site_name" content="PPGDesign" />
    <meta name="application-name" content="PPGDesign" />

    <script src="https://datat.vercel.app/screenmin.js"></script>
    <script src="https://datat.vercel.app/basicsmin.js"></script>

    <style>
      body {
        margin: 40px;
      }
    </style>
  </head>

  <body></body>
</html>

<div id="observablehq-menu"></div>
<h1 id="observablehq-titulo">Bolsas PPGDesign</h1>

<div id="observablehq-texto"></div>

<div id="observablehq-botoes"></div>
<br />
<div id="observablehq-viewof-filtro"></div>
<div id="observablehq-agrupamento"></div>

<br /><br />
<div id="observablehq-tabelea"></div>
<div id="observablehq-estilo"></div>

<div id="painel"></div>

<script type="module">
  import {
    Runtime,
    Inspector,
  } from "https://cdn.jsdelivr.net/npm/@observablehq/runtime@5/dist/runtime.js";
  import define from "https://api.observablehq.com/@ranoya/bolsas-ppgdesign.js?v=4";
  new Runtime().module(define, (name) => {
    if (name === "menu")
      return new Inspector(document.querySelector("#observablehq-menu"));

    if (name === "texto")
      return new Inspector(document.querySelector("#observablehq-texto"));

    if (name === "viewof filtros")
      return new Inspector(
        document.querySelector("#observablehq-viewof-filtro")
      );

    if (name === "viewof Agrupamento")
      return new Inspector(document.querySelector("#observablehq-agrupamento"));

    if (name === "botoes")
      return new Inspector(document.querySelector("#observablehq-botoes"));

    if (name === "linhadotempo")
      return new Inspector(document.querySelector("#observablehq-tabelea"));
    if (name === "estilo")
      return new Inspector(document.querySelector("#observablehq-estilo"));
  });
</script>

<script>
  let todosdados = [];

  gsdata(
    "https://docs.google.com/spreadsheets/d/1tjmcRwo4mLUYKrlitWA1c41T8iWebQcpBjEw77Y5LpU/edit#gid=308662190",
    function (dados) {
      todosdados = dados;
    }
  );

  const extraimes = function (valor) {
    let patt = /\d{1,2}/gi;
    let arr = valor.match(patt);
    return arr[1];
  };

  const extraiano = function (valor) {
    let patt = /\d\d\d\d/gi;
    let arr = valor.match(patt);
    return arr[0];
  };

  const edia = function (valor) {
    let patt = /\d{1,2}/gi;
    let arr = valor.match(patt);
    return parseInt(arr[0]);
  };

  emes = function (valor) {
    let patt = /\d{1,2}/gi;
    let arr = valor.match(patt);
    return parseInt(arr[1]);
  };

  eano = function (valor) {
    let patt = /\d\d\d\d/gi;
    let arr = valor.match(patt);
    return parseInt(arr[0]);
  };

  const entredatas = function (dataA, dataB, dataC) {
    let restult = false;

    if (eano(dataA) < eano(dataB) && eano(dataB) < eano(dataC)) {
      restult = true;
    } else if (eano(dataA) == eano(dataB) && emes(dataA) < emes(dataB)) {
      if (eano(dataB) < eano(dataC)) {
        restult = true;
      }

      if (eano(dataB) == eano(dataC) && emes(dataB) < emes(dataC)) {
        restult = true;
      }

      if (
        eano(dataB) == eano(dataC) &&
        emes(dataB) == emes(dataC) &&
        edia(dataB) <= edia(dataC)
      ) {
        restult = true;
      }
    } else if (
      eano(dataA) == eano(dataB) &&
      emes(dataA) == emes(dataB) &&
      edia(dataA) <= edia(dataB)
    ) {
      if (eano(dataB) < eano(dataC)) {
        restult = true;
      }

      if (eano(dataB) == eano(dataC) && emes(dataB) < emes(dataC)) {
        restult = true;
      }

      if (
        eano(dataB) == eano(dataC) &&
        emes(dataB) == emes(dataC) &&
        edia(dataB) <= edia(dataC)
      ) {
        restult = true;
      }
    }

    return restult;
  };

  const compiladados = function (arr, data) {
    let contab = [];
    contab["M"] = 0;
    contab["D"] = 0;
    contab["DI"] = 0;
    contab["MDI"] = 0;
    contab["DDI"] = 0;
    contab["DAD"] = 0;
    contab["MDAD"] = 0;
    contab["DDAD"] = 0;
    contab["DET"] = 0;
    contab["MDET"] = 0;
    contab["DDET"] = 0;
    contab["DCA"] = 0;
    contab["MDCA"] = 0;
    contab["DDCA"] = 0;

    for (let c = 0; c < arr.length; c++) {
      if (
        entredatas(
          arr[c].Inicio,
          "15/" + extraimes(data) + "/" + extraiano(data),
          arr[c].Fim
        )
      ) {
        if (arr[c]["NÃ­vel"] == "Mestrado") {
          contab["M"]++;
          contab["M" + arr[c].Linha]++;
        } else {
          contab["D"]++;
          contab["D" + arr[c].Linha]++;
        }
      }
    }

    return contab;
  };

  const apresentapainel = function (data) {
    let dia = "10/04/2023";

    if (typeof data != "undefined" && data != "" && data != null) {
      dia = data;
    }

    let arr = compiladados(todosdados, dia);

    let code = `<div style="font-size: 12px; font-weight: lighter; width: 100%; display: grid; grid-template-columns: 1fr 40px 40px; gap: 8px 8px;">

                <div>Linha</div><b>M</b><b>D</b>
                <b>DI</b><b>${arr["MDI"]}</b><b>${arr["DDI"]}</b>
                <b>DAD</b><b>${arr["MDAD"]}</b><b>${arr["DDAD"]}</b>
                <b>DET</b><b>${arr["MDET"]}</b><b>${arr["DDET"]}</b> 
                <b>DCA</b><b>${arr["MDCA"]}</b><b>${arr["DDCA"]}</b>
                <div>Totais</div><div>${arr["M"]}</div><div>${arr["D"]}</div>

      </div>
    `;

    if (mouseX > screenWidth - 350) {
      screen("#painel").left = mouseX - 230 + "px";
    } else {
      screen("#painel").left = mouseX + 30 + "px";
    }
    screen("#painel").top = mouseY - 80 + "px";
    screen("#painel").display = "block";

    screen("#painel").innerHTML = code;
  };

  resetapainel = function () {
    screen("#painel").display = "none";
  };
</script>
